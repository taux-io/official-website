worker_processes 1;

events { worker_connections 1024; }

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  _;
        root /usr/share/nginx/html;
        index index.html;

        # 直接處理這些靜態檔案
        location = /robots.txt  { }
        location = /sitemap.xml { }
        location = /favicon.ico { }

        # 靜態資源快取 - 開發友善設定
        # CSS 和 JS 檔案：較短快取時間，便於開發
        location ~* \.(js|css)$ {
            expires 1h;
            add_header Cache-Control "public, max-age=3600, must-revalidate";
            add_header Last-Modified $date_gmt;
            add_header ETag off;
            if_modified_since off;
        }
        
        # 圖片和字體：較長快取時間（這些通常不常變動）
        location ~* \.(png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
            expires 7d;
            add_header Cache-Control "public, max-age=604800";
        }
        
        # HTML 檔案：不快取，確保總是獲取最新版本
        location ~* \.html$ {
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
            add_header Pragma "no-cache";
        }

        # SPA fallback
        location / {
            try_files $uri $uri/ /index.html =404;
        }

        # 安全性最佳化
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
        add_header X-XSS-Protection "1; mode=block";
        add_header Referrer-Policy "strict-origin-when-cross-origin";
        add_header Permissions-Policy "geolocation=(), microphone=()";
    }
}